<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Academia AI - Intelligent Education Management System"
    />
    <meta
      name="keywords"
      content="education, AI, attendance, schedule, teacher, dashboard"
    />
    <title>Academia AI - Calendar</title>
    <link rel="stylesheet" href="style/style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body data-color-scheme="light">
    <!-- Main Application -->
    <div id="mainApp" class="main-app">
      <!-- Header -->
      <header class="app-header">
        <div class="header-left">
          <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>Academia AI</span>
          </div>
        </div>

        <div class="header-center">
          <div class="welcome-text">
            <span class="welcome-greeting">Welcome, Administrator!</span>
            <span class="status-badge">ACTIVE</span>
          </div>
        </div>

        <div class="header-right">
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search..." />
          </div>

          <button class="theme-toggle" id="themeToggle">
            <span class="theme-icon">üåô</span>
          </button>

          <div class="notifications">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">3</span>
          </div>

          <div class="user-menu">
            <button class="user-button" id="userMenuToggle">
              <span class="user-avatar" id="userAvatar">J</span>
              <span class="user-name" id="userName">John Doe</span>
              <span class="dropdown-arrow">‚ñº</span>
            </button>
            <div class="user-dropdown hidden" id="userDropdown">
              <div class="user-info">
                <div class="user-display-name" id="userDisplayName">
                  John Doe
                </div>
                <div class="user-email" id="userEmail">
                  admin@university.edu
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item" id="profileBtn">
                <span class="item-icon">üë§</span>
                Profile Settings
              </a>
              <a href="#" class="dropdown-item" id="settingsBtn">
                <span class="item-icon">‚öôÔ∏è</span>
                Dashboard Settings
              </a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item logout-item" id="logoutBtn">
                <span class="item-icon">üö™</span>
                Sign Out
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Layout -->
      <div class="app-layout">
        <!-- Sidebar -->
        <nav class="sidebar">
          <div class="nav-menu">
            <a href="dashboard.html" class="nav-item" data-nav="overview">
              <i class="fas fa-home"></i>
              <span>Overview</span>
            </a>
            <a href="prediction.html" class="nav-item" data-nav="prediction">
              <i class="fas fa-bullseye"></i>
              <span>Prediction</span>
            </a>
            <a href="analytics.html" class="nav-item" data-nav="analytics">
              <i class="fas fa-chart-line"></i>
              <span>Analytics</span>
            </a>
            <a href="graph.html" class="nav-item" data-nav="graph">
              <i class="fas fa-chart-bar"></i>
              <span>Graphs</span>
            </a>
            <a href="attendance.html" class="nav-item" data-nav="attendance">
              <i class="fas fa-check"></i>
              <span>Attendance</span>
            </a>
            <a href="classes.html" class="nav-item" data-nav="classes">
              <i class="fas fa-desktop"></i>
              <span>Classes</span>
            </a>
            <a href="calendar.html" class="nav-item active" data-nav="calendar">
              <i class="fas fa-calendar"></i>
              <span>Calendar</span>
            </a>
            <a href="profile.html" class="nav-item" data-nav="profile">
              <i class="fas fa-user"></i>
              <span>Profile</span>
            </a>
            <a href="about.html" class="nav-item" data-nav="about">
              <i class="fas fa-info-circle"></i>
              <span>About</span>
            </a>
          </div>

          <div class="sidebar-actions">
            <a href="login.html" class="action-btn primary">
              <span>Login</span>
              <i class="fas fa-arrow-right"></i>
            </a>
            <a href="index.html" class="action-btn secondary">
              <span>Sign Out</span>
              <i class="fas fa-arrow-right"></i>
            </a>
          </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
          <!-- Calendar Page -->
          <div id="calendarPage" class="page active">
            <div class="page-header">
              <h2>Academic Calendar</h2>
              <p>
                View and manage your teaching schedule, events, and important
                dates
              </p>
              <button class="add-event-btn" id="addEventBtn">
                <i class="fas fa-plus"></i>
                Add Event
              </button>
            </div>

            <div class="calendar-layout">
              <!-- Calendar Section -->
              <div class="calendar-section">
                <div class="calendar-container">
                  <div class="calendar-header">
                    <button
                      class="calendar-nav"
                      id="prevMonth"
                      aria-label="Previous month"
                    >
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <span class="calendar-month" id="currentMonth"
                      >March 2024</span
                    >
                    <button
                      class="calendar-nav"
                      id="nextMonth"
                      aria-label="Next month"
                    >
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </div>

                  <div class="calendar-grid">
                    <div class="calendar-weekdays">
                      <span>Sun</span>
                      <span>Mon</span>
                      <span>Tue</span>
                      <span>Wed</span>
                      <span>Thu</span>
                      <span>Fri</span>
                      <span>Sat</span>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                      <!-- Calendar days will be populated by JavaScript -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- Events Section -->
              <div class="events-section">
                <div class="events-header">
                  <h3>Events for <span id="selectedDate">Today</span></h3>
                  <button class="add-event-btn small" id="addEventForDateBtn">
                    <i class="fas fa-plus"></i>
                    Add Event
                  </button>
                </div>

                <div class="events-list" id="eventsList">
                  <!-- Events will be populated by JavaScript -->
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Add Lecture Modal -->
    <div class="modal-overlay" id="eventModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Add New Lecture</h3>
          <button class="modal-close" id="closeModal" title="Close modal">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="eventForm" class="event-form">
          <div class="form-group">
            <label for="eventTitle">Event Title</label>
            <input
              type="text"
              id="eventTitle"
              name="title"
              placeholder="Enter event title"
              required
            />
          </div>

          <div class="form-group">
            <label for="eventType">Event Type</label>
            <select id="eventType" name="type" required>
              <option value="">Select event type</option>
              <option value="lecture">Lecture</option>
              <option value="exam">Exam</option>
              <option value="assignment">Assignment Due</option>
              <option value="meeting">Meeting</option>
              <option value="holiday">Holiday</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="form-group">
            <label for="eventSubject">Subject (Optional)</label>
            <select id="eventSubject" name="subject">
              <option value="">Select subject (optional)</option>
              <option value="mathematics">Mathematics</option>
              <option value="physics">Physics</option>
              <option value="chemistry">Chemistry</option>
              <option value="biology">Biology</option>
              <option value="computer-science">Computer Science</option>
              <option value="english">English</option>
              <option value="history">History</option>
              <option value="geography">Geography</option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="eventDate">Date</label>
              <input type="date" id="eventDate" name="date" required />
            </div>

            <div class="form-group">
              <label for="eventTime">Time</label>
              <input type="time" id="eventTime" name="time" required />
            </div>
          </div>

          <div class="form-group">
            <label for="eventDuration">Duration (hours)</label>
            <input
              type="number"
              id="eventDuration"
              name="duration"
              min="0.5"
              max="8"
              step="0.5"
              value="1"
              required
            />
          </div>

          <div class="form-group">
            <label for="eventDescription">Event Description</label>
            <textarea
              id="eventDescription"
              name="description"
              placeholder="Enter event description"
              rows="3"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="eventColor">Color</label>
            <div
              class="color-picker"
              role="radiogroup"
              aria-labelledby="eventColor"
            >
              <input
                type="radio"
                id="color-blue"
                name="color"
                value="#3b82f6"
                checked
                aria-label="Blue color"
              />
              <label
                for="color-blue"
                class="color-option blue"
                title="Blue"
              ></label>

              <input
                type="radio"
                id="color-green"
                name="color"
                value="#10b981"
                aria-label="Green color"
              />
              <label
                for="color-green"
                class="color-option green"
                title="Green"
              ></label>

              <input
                type="radio"
                id="color-purple"
                name="color"
                value="#8b5cf6"
                aria-label="Purple color"
              />
              <label
                for="color-purple"
                class="color-option purple"
                title="Purple"
              ></label>

              <input
                type="radio"
                id="color-orange"
                name="color"
                value="#f59e0b"
                aria-label="Orange color"
              />
              <label
                for="color-orange"
                class="color-option orange"
                title="Orange"
              ></label>

              <input
                type="radio"
                id="color-red"
                name="color"
                value="#ef4444"
                aria-label="Red color"
              />
              <label
                for="color-red"
                class="color-option red"
                title="Red"
              ></label>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" id="cancelEvent">
              Cancel
            </button>
            <button type="submit" class="btn-primary">Save Event</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Immediate authentication check - before any other initialization
      (function () {
        const isLoggedIn =
          localStorage.getItem("isLoggedIn") ||
          sessionStorage.getItem("isLoggedIn");
        if (isLoggedIn !== "true") {
          window.location.href = "login.html";
          return;
        }
      })();

      // Calendar functionality
      class Calendar {
        constructor() {
          this.currentDate = new Date();
          this.selectedDate = new Date();
          this.events =
            JSON.parse(localStorage.getItem("calendarEvents")) || {};
          this.init();
        }

        init() {
          this.renderCalendar();
          this.bindEvents();
          this.loadEvents();
        }

        renderCalendar() {
          const year = this.currentDate.getFullYear();
          const month = this.currentDate.getMonth();

          document.getElementById("currentMonth").textContent =
            this.currentDate.toLocaleDateString("en-US", {
              month: "long",
              year: "numeric",
            });

          // Get the first day of the month
          const firstDay = new Date(year, month, 1);
          // Get the last day of the month
          const lastDay = new Date(year, month + 1, 0);

          // Calculate the start date (first day of the week that contains the first day of the month)
          const startDate = new Date(firstDay);
          const dayOfWeek = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
          startDate.setDate(startDate.getDate() - dayOfWeek);

          const calendarDays = document.getElementById("calendarDays");
          calendarDays.innerHTML = "";

          // Generate 6 weeks (42 days) to ensure we cover all possible month layouts
          for (let i = 0; i < 42; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);

            const dayElement = document.createElement("div");
            dayElement.className = "calendar-day";
            dayElement.textContent = date.getDate();

            // Check if this date is from the previous or next month
            if (date.getMonth() !== month) {
              dayElement.classList.add("other-month");
            }

            // Check if this is today
            if (this.isToday(date)) {
              dayElement.classList.add("today");
            }

            // Check if this is the selected date
            if (this.isSelected(date)) {
              dayElement.classList.add("selected");
            }

            // Check if this date has events
            if (this.hasEvents(date)) {
              dayElement.classList.add("has-events");
            }

            dayElement.addEventListener("click", () => this.selectDate(date));
            calendarDays.appendChild(dayElement);
          }
        }

        isToday(date) {
          const today = new Date();
          return date.toDateString() === today.toDateString();
        }

        isSelected(date) {
          return date.toDateString() === this.selectedDate.toDateString();
        }

        hasEvents(date) {
          const dateKey = this.formatDate(date);
          return this.events[dateKey] && this.events[dateKey].length > 0;
        }

        selectDate(date) {
          this.selectedDate = date;
          this.renderCalendar();
          this.loadEvents();
          document.getElementById("selectedDate").textContent =
            date.toLocaleDateString("en-US", {
              weekday: "long",
              month: "long",
              day: "numeric",
            });
        }

        loadEvents() {
          const dateKey = this.formatDate(this.selectedDate);
          const events = this.events[dateKey] || [];
          const eventsList = document.getElementById("eventsList");

          if (events.length === 0) {
            eventsList.innerHTML = `
              <div class="no-events">
                <i class="fas fa-calendar-plus"></i>
                <p>No events scheduled for this date</p>
                <button class="btn-primary" onclick="calendar.openAddEventModal()" title="Add first event for this date">
                  Add First Event
                </button>
              </div>
            `;
            return;
          }

          eventsList.innerHTML = events
            .map(
              (event) => `
            <div class="event-item" style="border-left-color: ${event.color}">
              <div class="event-header">
                <h4>${event.title}</h4>
                <div class="event-actions">
                  <button class="event-action" onclick="calendar.deleteEvent('${dateKey}', ${
                event.id
              })" aria-label="Delete event">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              <div class="event-details">
                <span class="event-type ${event.type || "event"}">${
                event.subject || event.type || "Event"
              }</span>
                <span class="event-time">
                  <i class="fas fa-clock"></i>
                  ${event.time} (${event.duration}h)
                </span>
              </div>
              ${
                event.description
                  ? `<p class="event-description">${event.description}</p>`
                  : ""
              }
            </div>
          `
            )
            .join("");
        }

        openAddEventModal(date = null) {
          const modal = document.getElementById("eventModal");
          const form = document.getElementById("eventForm");
          const title = document.getElementById("modalTitle");

          title.textContent = "Add New Event";
          form.reset();

          if (date) {
            document.getElementById("eventDate").value = this.formatDate(date);
          } else {
            document.getElementById("eventDate").value = this.formatDate(
              this.selectedDate
            );
          }

          modal.classList.add("active");
        }

        closeModal() {
          document.getElementById("eventModal").classList.remove("active");
        }

        saveEvent(eventData) {
          const dateKey = eventData.date;
          if (!this.events[dateKey]) {
            this.events[dateKey] = [];
          }

          const newEvent = {
            id: Date.now(),
            type: "event",
            ...eventData,
          };

          this.events[dateKey].push(newEvent);
          localStorage.setItem("calendarEvents", JSON.stringify(this.events));

          this.renderCalendar();
          this.loadEvents();
          this.closeModal();

          // Show success message
          this.showToast("Event saved successfully!", "success");
        }

        deleteEvent(dateKey, eventId) {
          if (confirm("Are you sure you want to delete this event?")) {
            this.events[dateKey] = this.events[dateKey].filter(
              (e) => e.id !== eventId
            );
            if (this.events[dateKey].length === 0) {
              delete this.events[dateKey];
            }

            localStorage.setItem("calendarEvents", JSON.stringify(this.events));
            this.renderCalendar();
            this.loadEvents();
            this.showToast("Event deleted successfully!", "success");
          }
        }

        bindEvents() {
          // Navigation
          document.getElementById("prevMonth").addEventListener("click", () => {
            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
            this.renderCalendar();
          });

          document.getElementById("nextMonth").addEventListener("click", () => {
            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
            this.renderCalendar();
          });

          // Add event buttons
          document
            .getElementById("addEventBtn")
            .addEventListener("click", () => {
              this.openAddEventModal();
            });

          document
            .getElementById("addEventForDateBtn")
            .addEventListener("click", () => {
              this.openAddEventModal(this.selectedDate);
            });

          // Modal events
          document
            .getElementById("closeModal")
            .addEventListener("click", () => {
              this.closeModal();
            });

          document
            .getElementById("cancelEvent")
            .addEventListener("click", () => {
              this.closeModal();
            });

          // Form submission
          document
            .getElementById("eventForm")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.handleFormSubmission();
            });
        }

        handleFormSubmission() {
          const form = document.getElementById("eventForm");
          const formData = new FormData(form);

          const eventData = {
            title: formData.get("title"),
            type: formData.get("type"),
            subject: formData.get("subject"),
            date: formData.get("date"),
            time: formData.get("time"),
            duration: parseFloat(formData.get("duration")),
            description: formData.get("description"),
            color: formData.get("color"),
          };

          this.saveEvent(eventData);
        }

        formatDate(date) {
          return date.toISOString().split("T")[0];
        }

        showToast(message, type = "info") {
          const toast = document.createElement("div");
          toast.className = `toast toast-${type}`;
          toast.innerHTML = `
            <i class="fas fa-${
              type === "success" ? "check-circle" : "info-circle"
            }"></i>
            <span>${message}</span>
          `;

          document.getElementById("toastContainer").appendChild(toast);

          setTimeout(() => {
            toast.classList.add("show");
          }, 100);

          setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => toast.remove(), 300);
          }, 3000);
        }
      }

      // Initialize calendar when DOM is loaded
      let calendar;
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize calendar
        calendar = new Calendar();

        // Update user interface with logged-in user info
        const userEmail =
          localStorage.getItem("userEmail") ||
          sessionStorage.getItem("userEmail");
        const userRole =
          localStorage.getItem("userRole") ||
          sessionStorage.getItem("userRole");

        if (userEmail) {
          const userName = userEmail
            .split("@")[0]
            .replace(".", " ")
            .replace("prof", "Prof.");
          const welcomeGreeting = document.querySelector(".welcome-greeting");
          const userNameElement = document.getElementById("userName");

          if (welcomeGreeting) {
            welcomeGreeting.textContent = `Welcome, ${
              userRole === "admin" ? "Administrator" : "Professor"
            }!`;
          }
          if (userNameElement) {
            userNameElement.textContent = userName.split(" ").pop();
          }
        }

        // Handle sign out
        const signOutBtn = document.querySelector('a[href="index.html"]');
        if (signOutBtn) {
          signOutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("userEmail");
            localStorage.removeItem("userRole");
            sessionStorage.removeItem("isLoggedIn");
            sessionStorage.removeItem("userEmail");
            sessionStorage.removeItem("userRole");
            window.location.href = "login.html";
          });
        }
      });
    </script>
    <script src="js/global.js"></script>
    <div id="toastContainer" class="toast-container"></div>
  </body>
</html>
